# 电商总结思路

+ 解决跨域的三种方式   
  - cors跨域 官方支持, 也可能存在兼容问题(http 1.1)
  - jsonp跨域 (利用 `src` 的漏洞),一般很少用,因为jsonp的接口是完全开放的,存在一定的安全隐患,除非数据不敏感,比如天气信息,适合使用,若是登录功能,就不要使用了
  - 反向代理 (民间方案) 比较可靠的解决方案, 4 行代码
    ```javascript
     1. 在 Apache 的其它选项菜单 ---> 打开配置文件 ---> vhosts-ini  的这个`</Directory>`闭合标签 和 `</VirtualHost>`闭合标签 之间写以下 两行代码

     // 关闭正向代理 (开启反向代理)
      ProxyRequests Off 
      //   /api  就 等同于 http://localhost:3000
      ProxyPass /api http://localhost:3000
    ```
    ```javascript
       2. 再在 Apache 的其它选项菜单 ---> 打开配置文件 ---> httpd-conf  中的两行代码的注释打开
       // LoadModule proxy_module modules/mod_proxy.so  //135行
       // LoadModule proxy_http_module modules/mod_proxy_http.so  //143行
    ```

## index.html (主页)
```javascript
 //检测用户是否已登录, 如果登录 显示用户信息, 相反则跳转 至 login.html
   $.ajax({
     //url: 'http://localhost//user/queryUserMessage'
     //如果直接访问 http://localhost:3000  会有跨域问题, 
     // 可以通过配置 Apache 的反向代理来解决
     //   /api 等同于  http://localhost:3000
       url: '/api/user/queryUserMessage',
       type: 'get',
       success: function (info) {
           //console.log(info);
           //console.log(info.username);

           // 登录页面上  显示用户名称
           $('span.uname').text(info.username);
           if (info.error) {
               location.href = './login.html';
           }
       }
   });
```

## register.html(注册页面)



 基本思路:
     //1.获取用户表单输入的信息
    //2.将用户信息发送到服务端
    //3.等待服务器端的回应

```javascript
   //获取验证码   
   $('.btn_getCode').on('click', function () {
       $.ajax({
           url: '/api/user/vCode',
           type: 'get',
           data: {
               mobile: $('.mobile').val()
           },
           success: function (info) {
               console.log(info);
           }
       })
   })


    //通过点击 注册 按钮 事件 操作以下 
    $('form').on('submit', function () {
        // alert(1);
        //1.获取用户表单输入的信息
        var data = $(this).serialize();
        //2.将用户信息发送到服务端
        $.ajax({
            url: '/api/user/register',
            type: 'post',
            data: data,
            //3.等待服务器端的回应
            success: function (info) {
                // console.log(info);
               if(info.success) {
                   location.href = './login.html';                  
               }
            }
        });
        
        //阻止表单的默认提交 （使用 Ajax 提交）
        return false;

    })
```

## login.html(登录页面)
```javascript
 // 当用户点击 登录 按钮时, 发送 ajax请求
        $('.btn_login').on('click', function () {
            $.ajax({
                url: '/api/user/login',
                type: 'post',
                data: {
                    username: $('input[name="name"]').val(),
                    password: $('input[name="pass"]').val()
                },
                success: function (info) {
                    console.log(info);
                    if (info) {
                        location.href = './index.html';
                    }
                }
            })
        })
```

## address.html(收货地址管理 页面)
  - 在这个项目中，没有做编辑(addressEdit.html) 和 删除(addressDelete.html)，只做了添加(addressAdd.html) 和 列表(address.html 的 列表显示[用模板引擎显示的])
   其中还用到了 省市级(三级)联动的插件 和 模板引擎


```javascript
   //获取用户的收货地址
   //1.在登录状态下 发送请求即可
   $.ajax({
       url: '/api/address/queryAddress',
       type: 'get',
       success: function (info){
          // console.log(info);
          //调用模板引擎  
          //           参数1:模板的id 参数2:要解析的数据(注: 必须是json)
          var html = template('tel', {list: info});
          console.log(html);
          $('#muban').html(html);
       }
   })
```
## addressAdd.html(添加收货地址 页面)

+ 用插件写三级联动，修改的样式如下：
   - 使用该插件的要求(3个)：
     - 1.在 ```<select>``` 标签的最外面包裹上一个盒子(如下示例：class 为 region);
     - 2.必须在 ```<select>``` 标签内设置上 `id`, `id`值没有要求;
     - 3.需要在 ```<select>``` 标签内设置上 `data-id` 属性, 值为 空, `data-id = " "`

      
```css
<div class="region">
    <select id="p" data-id="">
        <option value="">请选择省</option>
    </select>
    <select id="c" data-id="">
        <option value="">请选择城市</option>
    </select>
    <select id="d" data-id="">
        <option value="">请选择区/县</option>
    </select>
</div>
```
```javascript
    <script src="../res/mui/js/mui.min.js"></script>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/jquery.region.js"></script>
    <script>

        // 通过 jQuery 插件来实现省市县三级联动
        $('.region').region({
            url: '../js/region.json'
        });

        // 由于没有初始地址，需要用添加
        // 提供添加地址的页面

        $('form').on('submit', function () {
            // 1. 获取用户填写的信息
            // serialize 默认会忽略没有 name 的表单项
            var data = $(this).serialize();

            var ptext = $('#p option:selected').text();
            var ctext = $('#c option:selected').text();
            var dtext = $('#d option:selected').text();
            
            // 将省市县拼凑然后发送
            data += '&address=' + ptext + ctext + dtext;

            // 2. 发送到服务端
            $.ajax({
                url: '/api/address/addAddress',
                type: 'post',
                data: data,
                // 3. 等待服务端的响应结果
                success: function (info) {
                    console.log(info)
                    if(info.success) {
                        location.href = './address.html';
                    }
                }
            })

            // 阻止默认提交
            return false;
        })
    </script>
```
